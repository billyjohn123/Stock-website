<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lime Quarry Stock Tracker</title>
  <style>
    table {
      border-collapse: collapse;
      margin-bottom: 30px;
      width: 100%;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: left;
    }
    h1, h2 {
      font-family: Arial, sans-serif;
    }
    form label {
      display: block;
      margin: 8px 0 4px;
    }
    form input, form select {
      width: 200px;
      padding: 6px;
    }
    button {
      margin-top: 12px;
      padding: 8px 12px;
    }
  </style>
</head>
<body>
  <h1>Lime Quarry Stock Tracker</h1>

  <h2>Organic Stock</h2>
  <table id="organic-table">
    <thead>
      <tr>
        <th>Product</th>
        <th>Type</th>
        <th>Supplier</th>
        <th>Cost Price ($/kg)</th>
        <th>Amount (kg)</th>
        <th>Last Delivery Date</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Non-Organic Stock</h2>
  <table id="non-organic-table">
    <thead>
      <tr>
        <th>Product</th>
        <th>Type</th>
        <th>Supplier</th>
        <th>Cost Price ($/kg)</th>
        <th>Amount (kg)</th>
        <th>Last Delivery Date</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <form id="add-stock-form">
    <h2>Add to Inventory</h2>
    <label>Product Name:
      <input type="text" name="product" required />
    </label>
    <label>Product Type:
      <input type="text" name="product_type" required />
    </label>
    <label>Organic:
      <select name="is_organic" required>
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>
    </label>
    <label>Supplier:
      <input type="text" name="supplier" required />
    </label>
    <label>Cost Price per kg ($):
      <input type="number" step="0.01" name="cost_price" required />
    </label>
    <label>Delivery Date:
      <input type="date" name="delivery_date" required />
    </label>
    <label>Delivery Amount (kg):
      <input type="number" name="delivery_amount" required />
    </label>
    <button type="submit">Add Stock</button>
  </form>

  <script>
    async function loadStock() {
      try {
        const res = await fetch('/api/stock');
        if (!res.ok) throw new Error('Failed to load stock');
        const stock = await res.json();

        const organicBody = document.querySelector('#organic-table tbody');
        const nonOrganicBody = document.querySelector('#non-organic-table tbody');

        organicBody.innerHTML = '';
        nonOrganicBody.innerHTML = '';

        stock.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.product}</td>
            <td>${item.type}</td>
            <td>${item.supplier}</td>
            <td>$${parseFloat(item.cost_price).toFixed(2)}</td>
            <td>${item.delivery_amount}</td>
            <td>${item.delivery_date}</td>
          `;
          if (Number(item.is_organic) === 1) {
            organicBody.appendChild(tr);
          } else {
            nonOrganicBody.appendChild(tr);
          }
        });
      } catch (err) {
        console.error('Error loading stock:', err);
      }
    }

    document.getElementById('add-stock-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const payload = {
        product: formData.get('product'),
        product_type: formData.get('product_type'),
        is_organic: parseInt(formData.get('is_organic')),
        supplier: formData.get('supplier'),
        cost_price: parseFloat(formData.get('cost_price')),
        delivery_date: formData.get('delivery_date'),
        delivery_amount: parseInt(formData.get('delivery_amount'))
      };

      try {
        const res = await fetch('/api/add', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error('Failed to add stock');
        e.target.reset();
        loadStock();
      } catch (err) {
        console.error(err);
      }
    });

    loadStock();
  </script>
</body>
</html>
